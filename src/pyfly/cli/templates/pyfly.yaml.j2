pyfly:
  app:
    name: {{ name }}
{% if archetype not in ("library", "cli") %}
    module: {{ package_name }}.main:app
{% endif %}

{% if has_web or has_fastapi or archetype in ("web-api", "fastapi-api", "web", "hexagonal", "core") %}
  web:
    port: 8080
{% if has_fastapi or archetype == "fastapi-api" %}
    adapter: fastapi
{% else %}
    adapter: auto
{% endif %}
{% endif %}

{% if has_web or has_fastapi %}
  server:
    type: "auto"
    event-loop: "auto"
    workers: 0
{% if has_granian %}
    granian:
      runtime-threads: 1
      runtime-mode: "auto"
{% endif %}
{% endif %}

{% if archetype == "cli" or has_shell %}
  shell:
    enabled: true
{% endif %}

{% if archetype != "library" %}
  actuator:
    endpoints:
      enabled: true
{% endif %}

{% if has_web or has_fastapi or archetype in ("web-api", "fastapi-api", "web", "hexagonal") %}
  admin:
    enabled: true
    # title: "{{ name }} Admin"
    # theme: auto
    # require_auth: false
{% endif %}

  logging:
    level:
      root: INFO
{% if has_data %}

  data:
    relational:
      enabled: true
      url: sqlite+aiosqlite:///{{ package_name }}.db
{% endif %}
{% if has_mongodb %}

  data:
    document:
      enabled: true
      uri: mongodb://localhost:27017
      database: {{ package_name }}
{% endif %}
{% if has_cache %}

  cache:
    enabled: true
    provider: memory
    ttl: 300
    # Redis (production — install pyfly[redis] and uncomment):
    # provider: redis
    # redis:
    #   url: redis://localhost:6379/0
{% endif %}
{% if has_eda %}

  messaging:
    provider: memory
    # Kafka (production — install pyfly[kafka] and uncomment):
    # provider: kafka
    # kafka:
    #   bootstrap-servers: localhost:9092
{% endif %}
{% if has_security %}

  security:
    jwt:
      secret: change-me-in-production
      expiration: 3600
{% endif %}
{% if has_observability %}

  observability:
    metrics:
      enabled: true
    tracing:
      enabled: true
{% endif %}
{% if has_transactional %}

  transactional:
    enabled: true
    # saga:
    #   default_timeout_ms: 30000
    #   recovery_interval_ms: 60000
    # tcc:
    #   default_timeout_ms: 30000
{% endif %}
