"""Item business logic."""
{% if not has_data and not has_mongodb %}

import uuid
{% endif %}

from pyfly.container import service

from {{ package_name }}.models.item import ItemCreate, ItemResponse
{% if has_data %}
from {{ package_name }}.models.item import ItemEntity
from {{ package_name }}.repositories.item_repository import ItemRepository
{% elif has_mongodb %}
from {{ package_name }}.models.item import ItemDocument
from {{ package_name }}.repositories.item_repository import ItemDocumentRepository
{% else %}
from {{ package_name }}.repositories.item_repository import ItemRepository
{% endif %}


@service
class ItemService:
{% if has_data %}

    def __init__(self, repository: ItemRepository) -> None:
        self._repository = repository

    async def create(self, data: ItemCreate) -> ItemResponse:
        entity = ItemEntity(name=data.name, description=data.description)
        saved = await self._repository.save(entity)
        return ItemResponse(id=saved.id, name=saved.name, description=saved.description)

    async def get(self, item_id: int) -> ItemResponse:
        entity = await self._repository.find_by_id(item_id)
        return ItemResponse(id=entity.id, name=entity.name, description=entity.description)

    async def list_all(self) -> list[ItemResponse]:
        entities = await self._repository.find_all()
        return [ItemResponse(id=e.id, name=e.name, description=e.description) for e in entities]

    async def delete(self, item_id: int) -> None:
        await self._repository.delete(item_id)
{% elif has_mongodb %}

    def __init__(self, repository: ItemDocumentRepository) -> None:
        self._repository = repository

    async def create(self, data: ItemCreate) -> ItemResponse:
        doc = ItemDocument(name=data.name, description=data.description)
        saved = await self._repository.save(doc)
        return ItemResponse(id=str(saved.id), name=saved.name, description=saved.description)

    async def get(self, item_id: str) -> ItemResponse:
        doc = await self._repository.find_by_id(item_id)
        return ItemResponse(id=str(doc.id), name=doc.name, description=doc.description)

    async def list_all(self) -> list[ItemResponse]:
        docs = await self._repository.find_all()
        return [ItemResponse(id=str(d.id), name=d.name, description=d.description) for d in docs]

    async def delete(self, item_id: str) -> None:
        await self._repository.delete(item_id)
{% else %}

    def __init__(self, repository: ItemRepository) -> None:
        self._repository = repository

    def create(self, data: ItemCreate) -> ItemResponse:
        item_id = str(uuid.uuid4())
        item = ItemResponse(id=item_id, name=data.name, description=data.description)
        self._repository.save(item_id, item)
        return item

    def get(self, item_id: str) -> ItemResponse:
        return self._repository.find_by_id(item_id)

    def list_all(self) -> list[ItemResponse]:
        return self._repository.find_all()

    def delete(self, item_id: str) -> None:
        self._repository.delete(item_id)
{% endif %}
